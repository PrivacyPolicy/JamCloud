<!DOCTYPE html>
<html lang=en>
    <head>
        <meta charset=utf-8>
        <title>JamCloud</title>
        
        <script src=jquery.min.js></script>
        <script src=interface.js></script>
        <script src=sounds.js></script>

        <script>
            var timeScale = 100; // 100 px / second
                                // future: px/beats
            var instrumentTypes = ["Piano", "Guitar", "Drum", 
                "Electric Guitar"];
            var data = {
                instruments: [
                    {
                        id: 1,
                        type: 0, // instruments[0] == "Paino"
                        clips: [
                            new Clip(1, 1, 2, 0),
                            new Clip(2, 3, 4, 0),
                            new Clip(3, 2, 1, 0)
                            ]
                    },
                    {
                        id: 2,
                        type: 2, // instruments[2] == "Drum"
                        clips: [
                            new Clip(4, 2, 2, 2),
                            new Clip(5, 4, 4, 2),
                            new Clip(6, 3, 1, 2)
                            ]
                    },
                    {
                        id: 3,
                        type: 3, // instruments[3] == "Electric Guitar"
                        clips: [
                            new Clip(7, 1, 2, 3),
                            new Clip(8, 3, 4, 3),
                            new Clip(9, 2, 1, 3)
                            ]
                    }
                    ]
            };
            function Clip(id, startTime, duration, instrument) {
                this.id = id;
                this.startTime = startTime;
                this.duration = duration;
                this.instrument = instrument;
            }
            function noteClip(startime, duration, instrument, notes) {
//                notes: [
//                    {pitch: 74, startTime: 2.4, duration: 1.3},
//                    ...
//                ]
                //Clip.call(this);
                this = new Clip(startTime, duration, instrument);
                this.notes = notes;
            }
            
            function buildTable() {
                // Empty the table of any instruments
                $("#content tr:not(.persistant)").remove();
                
                // go through and add the instruments
                for (var i = 0; i < data.instruments.length; i++) {
                    addInstrument(data.instruments[i]);
                }
                if (i === 0) { // No instruments: new file
                    // TODO show new file options
                }
            }
            
            function addInstrument(instrument) {
                // Make a copy of the template
                var template = $("#instrumentTemplate").get(0).cloneNode(true);
                template.id = "instrument_" + instrument.id;
                var $temp = $(template);
                // edit the template values
                $temp.removeClass("persistant");
                $temp.find(".instrumentType").text(
                    instrumentsTypes[instrument.type]);
                // add the clips
                for (var i = 0; i < instrument.clips; i++) {
                    addClip(instrument.id, instrument.clips[i]);
                }
                
                // add the newly-filled template to the list
                $("#instrumentTemplate").before($temp);
            }
            function addClip(instrument, clip) {
                // copy the template
                var template = $("$clipTelmplate").get(0).cloneNode(true);
                template.id = "clip_" + clip.id;
                var $clipElem = $(template);
                
                // edit the template values
                $clipElem.
                
                // add the newly-filled template to the list
                var $instrument = $("#" + instrument);
                $instrument.insertAfter($clipElem,
                    $instrument.children().last());
            }
        </script>
        
        <link href="https://fonts.googleapis.com/css?family=Ubuntu"
              rel="stylesheet">
        <!--<link href="https://fonts.googleapis.com/css?family=Roboto"
              rel="stylesheet">-->
        <link rel=stylesheet href=styles.css>
    </head>
    <body>
        
        <div id=content>
            <div id=instrumentTemplate class="instrument persistant">
                <div class=instrumentType></div>
                <div class=clipTimeline></div>
            </div>
            <div id=clipTemplate class="clip persistant">
                
            </div>
        </div>
        
    </body>
</html>
